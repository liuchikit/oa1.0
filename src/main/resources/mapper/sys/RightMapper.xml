<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhumian.mapper.sys.RightMapper" >

    <select id="queryRights"  parameterType="java.util.Map" resultType="RightVO">
        SELECT rig.*,u.ID userId,role.ID roleId
        FROM TB_RIGHT rig
        LEFT JOIN TB_ROLE_RIGHT rr ON rr.RIGHT_ID = rig.ID
        LEFT JOIN TB_ROLE role ON role.ID = rr.ROLE_ID
        <if test="roleId != null">
            AND role.ID = #{roleId}
        </if>
        LEFT JOIN TB_USER_ROLE ur ON ur.ROLE_ID = role.ID
        LEFT JOIN TB_USER u ON u.ID = ur.USER_ID
        <if test="userId != null">
            AND u.ID = #{userId}
        </if>
        WHERE 1 = 1

        <if test="rightType != null">
            AND rig.RIGHT_type = #{rightType}
        </if>
        <if test="level != null">
            AND rig.LEVEL = #{level}
        </if>
        <if test="pid != null">
            AND rig.PID = #{pid}
        </if>
        GROUP BY rig.ID
        ORDER BY rig.SORT ASC
    </select>

</mapper>